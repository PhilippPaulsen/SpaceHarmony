<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title data-i18n="app.title">Space Harmony – The World of Forms</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'/>" />
  <link rel="stylesheet" href="styles.css?v=1.2" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet" />


  <!-- Scripts -->
  <script type="importmap">
    {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.module.js",
        "three/": "https://cdn.jsdelivr.net/npm/three@0.152.2/",
        "three/examples/jsm/controls/OrbitControls.js": "https://cdn.jsdelivr.net/npm/three@0.152.2/examples/jsm/controls/OrbitControls.js"
      }
    }
  </script>
</head>

<body>
  <div class="app-shell">
    <main class="workspace-grid">
      <section class="canvas-card glass-panel">
        <header class="card-header">
          <div class="card-title">
            <h2 data-i18n="app.heading">Space Harmony</h2>
          </div>
          <div class="card-actions">
            <span class="canvas-status" id="face-count">Faces: 0 | Volumes: 0</span>
            <button type="button" id="theme-toggle" class="icon-button" data-i18n-title="ui.theme.toggle"
              title="Toggle Theme" aria-label="Toggle Color Scheme">
              <span class="material-icons-outlined" aria-hidden="true">dark_mode</span>
            </button>
          </div>
        </header>
        <div id="canvas-container" class="canvas-frame">
          <canvas id="three-canvas" width="720" height="720"></canvas>
        </div>
      </section>

      <aside>
        <section class="control-card glass-panel">
          <div class="control-content">
            <div class="icon-strip">
              <button type="button" id="undo-button" class="icon-button" data-i18n-title="ui.undo" title="Undo">
                <span class="material-icons-outlined" aria-hidden="true">undo</span>
              </button>
              <button type="button" id="redo-button" class="icon-button" data-i18n-title="ui.redo" title="Redo">
                <span class="material-icons-outlined" aria-hidden="true">redo</span>
              </button>
              <button type="button" id="random-form-button" class="icon-button" data-i18n-title="ui.random"
                title="Random Form">
                <span class="material-icons-outlined" aria-hidden="true">auto_awesome</span>
              </button>
              <button type="button" id="clear-button" class="icon-button" data-i18n-title="ui.clear" title="Clear All">
                <span class="material-icons-outlined" aria-hidden="true">delete_sweep</span>
              </button>
            </div>
            <div class="icon-strip">
              <button type="button" id="import-json-button" class="icon-button" data-i18n-title="ui.import"
                title="Import JSON">
                <span class="material-icons-outlined" aria-hidden="true">upload_file</span>
              </button>
              <button type="button" id="export-json-button" class="icon-button" data-i18n-title="ui.export.json"
                title="Export JSON">
                <span class="material-icons-outlined" aria-hidden="true">download</span>
              </button>
              <button type="button" id="export-obj-button" class="icon-button" data-i18n-title="ui.export.obj"
                title="Export OBJ">
                <span class="material-icons-outlined" aria-hidden="true">view_in_ar</span>
              </button>
              <button type="button" id="export-png-button" class="icon-button" data-i18n-title="ui.export.png"
                title="Export PNG">
                <span class="material-icons-outlined" aria-hidden="true">image</span>
              </button>
            </div>
          </div>

          <details open>
            <summary data-i18n="ui.display">Display</summary>

            <div class="control-row" style="margin-bottom: 8px;">
              <span class="control-label">System</span>
              <select id="coord-system" class="select-field" style="max-width: 140px;">
                <option value="cubic">Cubic</option>
                <option value="icosahedral">Icosahedral</option>
              </select>
            </div>

            <div class="control-row">
              <span class="control-label" data-i18n="ui.density">Point Density</span>
              <div style="display:flex; align-items:center; gap:8px;">
                <input type="number" id="grid-density" class="number-input" min="1" max="12" step="1" value="1" />
                <button type="button" id="toggle-auto-rotate" class="icon-button small" title="Auto Rotate"
                  aria-label="Auto Rotate" style="width:30px; height:30px;">
                  <span class="material-icons-outlined" style="font-size:18px;">360</span>
                </button>
              </div>
            </div>
            <div class="toggle-grid">
              <label class="icon-toggle" data-i18n-title="ui.show.points" title="Show Points" aria-label="Show Points">
                <input type="checkbox" id="toggle-points" checked />
                <span class="material-icons-outlined" aria-hidden="true">grain</span>
              </label>
              <label class="icon-toggle" data-i18n-title="ui.show.lines" title="Show Lines" aria-label="Show Lines">
                <input type="checkbox" id="toggle-lines" checked />
                <span class="material-icons-outlined" aria-hidden="true">timeline</span>
              </label>
              <label class="icon-toggle" data-i18n-title="ui.show.closed" title="Show Closed Shapes"
                aria-label="Show Closed Shapes">
                <input type="checkbox" id="toggle-show-closed" checked />
                <span class="material-icons-outlined" aria-hidden="true">category</span>
              </label>
              <label class="icon-toggle" data-i18n-title="ui.show.frame" title="Show Cube Frame"
                aria-label="Show Cube Frame">
                <input type="checkbox" id="toggle-cube-frame" checked />
                <span class="material-icons-outlined" aria-hidden="true">crop_landscape</span>
              </label>
            </div>

            <!-- Curve Row -->
            <div class="toggle-grid" style="margin-top: 8px;">
              <label class="icon-toggle" data-i18n-title="ui.show.curves" title="Show Curves" aria-label="Show Curves">
                <input type="checkbox" id="toggle-curved-lines" />
                <span class="material-icons-outlined" aria-hidden="true">rounded_corner</span>
              </label>
              <label class="icon-toggle" data-i18n-title="ui.show.surfaces" title="Show Curved Surfaces"
                aria-label="Show Curved Surfaces">
                <input type="checkbox" id="toggle-curved-surfaces" />
                <span class="material-icons-outlined" aria-hidden="true">texture</span>
              </label>

              <!-- Convex/Concave Slider -->
              <div style="display:flex; align-items:center; margin-left:8px; gap:4px;">
                <span class="material-icons-outlined" style="font-size:14px; opacity:0.7;"
                  title="Convex">trip_origin</span>
                <input type="range" id="curve-convexity" class="range-input" min="0" max="1" step="0.05" value="0"
                  style="width: 70px;" title="Convex to Concave">
                <span class="material-icons-outlined" style="font-size:14px; opacity:0.7;"
                  title="Concave">all_out</span>
              </div>
            </div>
          </details>

          <!-- Generator Button -->
          <div class="control-group" style="margin-top: 10px; margin-bottom: 10px;">
            <button id="btn-generator" class="action-button full-width"
              style="display: flex; align-items: center; justify-content: center; gap: 8px; padding: 10px;">
              <span class="material-icons-outlined">auto_awesome</span>
              <span data-i18n="ui.generator">Form Generator</span>
            </button>
          </div>

          <!--
          <details open>
            <summary class="section-label" style="justify-content: flex-start; gap: 8px;">
              <span data-i18n="ui.shapes">Shapes</span>
            </summary>
            <div class="control-content">
              <div class="icon-strip">
                <button type="button" id="close-face-button" class="icon-button" data-i18n-title="ui.close.face"
                  title="Close Face">
                  <span class="material-icons-outlined" aria-hidden="true">grid_on</span>
                </button>
                <button type="button" id="close-volume-button" class="icon-button" data-i18n-title="ui.close.volume"
                  title="Close Volume">
                  <span class="material-icons-outlined" aria-hidden="true">view_module</span>
                </button>
                <button type="button" id="auto-close-all-button" class="icon-button" data-i18n-title="ui.auto.close"
                  title="Auto-close All">
                  <span class="material-icons-outlined" aria-hidden="true">select_all</span>
                </button>
              </div>
              <div class="icon-toggle-row">
                <label class="icon-toggle" data-i18n-title="ui.auto.mode" title="Auto-close Faces"
                  aria-label="Auto-close Faces">
                  <input type="checkbox" id="toggle-auto-close" />
                  <span class="material-icons-outlined" aria-hidden="true">auto_mode</span>
                </label>
                <label class="icon-toggle" data-i18n-title="ui.highlight" title="Enable Color Highlights"
                  aria-label="Enable Color Highlights">
                  <input type="checkbox" id="toggle-color-highlights" />
                  <span class="material-icons-outlined" aria-hidden="true">highlight_alt</span>
                </label>
                <label class="icon-toggle" data-i18n-title="ui.auto.rotate" title="Auto Rotate"
                  aria-label="Auto Rotate">
                  <input type="checkbox" id="toggle-auto-rotate" checked />
                  <span class="material-icons-outlined" aria-hidden="true">360</span>
                </label>
              </div>
            </div>
          </details>
          -->
          <div style="display:none"> <!-- Keeping just auto-rotate accessible if needed? No, UI redesign requested. -->
          </div>

          <details open>
            <summary class="section-label" style="justify-content: flex-start; gap: 8px;">
              <span data-i18n="ui.symmetries">Symmetries</span>
            </summary>
            <div class="control-content">
              <div id="cubic-symmetries" class="icon-toggle-grid">
                <label class="icon-toggle" data-i18n-title="ui.reflection.xy" title="Reflection XY"
                  aria-label="Reflection XY">
                  <input type="checkbox" id="reflection-xy" checked />
                  <span class="material-icons-outlined" aria-hidden="true">flip</span>
                  <span class="icon-hint">XY</span>
                </label>
                <label class="icon-toggle" data-i18n-title="ui.reflection.yz" title="Reflection YZ"
                  aria-label="Reflection YZ">
                  <input type="checkbox" id="reflection-yz" checked />
                  <span class="material-icons-outlined" aria-hidden="true">flip</span>
                  <span class="icon-hint">YZ</span>
                </label>
                <label class="icon-toggle" data-i18n-title="ui.reflection.zx" title="Reflection ZX"
                  aria-label="Reflection ZX">
                  <input type="checkbox" id="reflection-zx" checked />
                  <span class="material-icons-outlined" aria-hidden="true">flip</span>
                  <span class="icon-hint">ZX</span>
                </label>
              </div>

              <div id="icosahedral-symmetries" class="icon-toggle-grid"
                style="display:none; grid-template-columns: 1fr;">
                <label class="icon-toggle" style="width: auto; justify-content: flex-start; padding-left: 10px;"
                  data-i18n-title="ui.symmetry.full_ih" title="Full Icosahedral Symmetry">
                  <input type="checkbox" id="toggle-full-icosa" checked />
                  <span class="material-icons-outlined" aria-hidden="true">hub</span>
                  <span style="font-size: 0.8rem; margin-left: 8px;">Full Symmetry ($I_h$)</span>
                </label>
              </div>
              <label class="icon-toggle" data-i18n-title="ui.inversion" title="Enable Inversion"
                aria-label="Enable Inversion">
                <input type="checkbox" id="toggle-inversion" />
                <span class="material-icons-outlined" aria-hidden="true">all_out</span>
              </label>
            </div>
          </details>

          <details>
            <summary data-i18n="ui.transformations">Transformations</summary>
            <div class="control-content transform-content">
              <label class="field inline compact" for="rotation-axis">
                <span class="field-label">
                  <span class="material-icons-outlined" aria-hidden="true">rotate_90_degrees_ccw</span>
                </span>
                <select id="rotation-axis" class="select-field">
                  <option value="none" data-i18n="ui.none">Rotation: None</option>
                  <option value="x">X</option>
                  <option value="y">Y</option>
                  <option value="z">Z</option>
                  <option value="all" selected>XYZ</option>
                </select>
              </label>

              <div class="fieldset dense">
                <div class="fieldset-header" data-i18n="ui.rotoreflection">Rotoreflection</div>
                <div class="field-grid tight">
                  <label class="field inline compact" for="rotoreflection-axis">
                    <span class="field-label" aria-hidden="true" data-i18n="ui.axis">Axis</span>
                    <select id="rotoreflection-axis" class="select-field">
                      <option value="none" data-i18n="ui.none">None</option>
                      <option value="x">X</option>
                      <option value="y">Y</option>
                      <option value="z">Z</option>
                    </select>
                  </label>
                  <label class="field inline compact" for="rotoreflection-plane">
                    <span class="field-label" aria-hidden="true" data-i18n="ui.plane">Plane</span>
                    <select id="rotoreflection-plane" class="select-field">
                      <option value="xy">XY</option>
                      <option value="yz">YZ</option>
                      <option value="zx">ZX</option>
                    </select>
                  </label>
                  <label class="field inline compact" for="rotoreflection-angle">
                    <span class="field-label" data-i18n="ui.angle">Angle</span>
                    <input type="number" id="rotoreflection-angle" class="number-input small" min="0" max="360" step="1"
                      value="180" />
                  </label>
                  <label class="field inline compact" for="rotoreflection-count">
                    <span class="field-label" data-i18n="ui.count">Count</span>
                    <input type="number" id="rotoreflection-count" class="number-input small" min="0" max="12" step="1"
                      value="0" />
                  </label>
                  <label class="icon-toggle span-full" data-i18n-title="ui.enable" title="Enable Rotoreflection"
                    aria-label="Enable Rotoreflection">
                    <input type="checkbox" id="rotoreflection-enabled" />
                    <span class="material-icons-outlined" aria-hidden="true">toggle_on</span>
                  </label>
                  <label class="field inline compact span-full" for="rotoreflection-connect">
                    <span class="field-label" data-i18n="ui.connect">Connect Points (Trace)</span>
                    <input type="checkbox" id="rotoreflection-connect" />
                  </label>
                </div>
              </div>

              <div class="fieldset dense">
                <div class="fieldset-header" data-i18n="ui.translation">Translation</div>
                <div class="field-grid tight">
                  <label class="field inline compact" for="translation-axis">
                    <span class="field-label" data-i18n="ui.axis">Axis</span>
                    <select id="translation-axis" class="select-field">
                      <option value="none" data-i18n="ui.none">None</option>
                      <option value="x">X</option>
                      <option value="y">Y</option>
                      <option value="z">Z</option>
                      <option value="all">XYZ</option>
                    </select>
                  </label>
                  <label class="field inline compact" for="translation-count">
                    <span class="field-label" data-i18n="ui.count">Count</span>
                    <input type="number" id="translation-count" class="number-input small" min="0" max="12" step="1"
                      value="0" />
                  </label>
                  <label class="field inline compact" for="translation-step">
                    <span class="field-label" data-i18n="ui.step">Step</span>
                    <input type="number" id="translation-step" class="number-input small" min="0.1" max="2.0" step="0.1"
                      value="0.5" />
                  </label>
                  <label class="field inline compact span-full" for="translation-connect">
                    <span class="field-label" data-i18n="ui.connect">Connect Points</span>
                    <input type="checkbox" id="translation-connect" />
                  </label>
                </div>
              </div>

              <div class="fieldset dense">
                <div class="fieldset-header" data-i18n="ui.screw">Screw</div>
                <div class="field-grid tight">
                  <label class="field inline compact" for="screw-axis">
                    <span class="field-label" data-i18n="ui.axis">Axis</span>
                    <select id="screw-axis" class="select-field">
                      <option value="none" data-i18n="ui.none">None</option>
                      <option value="x">X</option>
                      <option value="y">Y</option>
                      <option value="z">Z</option>
                    </select>
                  </label>
                  <label class="field inline compact" for="screw-angle">
                    <span class="field-label" data-i18n="ui.angle">Angle</span>
                    <input type="number" id="screw-angle" class="number-input small" min="0" max="360" step="1"
                      value="180" />
                  </label>
                  <label class="field inline compact" for="screw-distance">
                    <span class="field-label" data-i18n="ui.distance">Dist</span>
                    <input type="number" id="screw-distance" class="number-input small" min="0.1" max="2.0" step="0.1"
                      value="0.5" />
                  </label>
                  <label class="field inline compact" for="screw-count">
                    <span class="field-label" data-i18n="ui.count">Count</span>
                    <input type="number" id="screw-count" class="number-input small" min="0" max="12" step="1"
                      value="0" />
                  </label>
                  <label class="icon-toggle span-full" data-i18n-title="ui.enable" title="Enable Screw"
                    aria-label="Enable Screw">
                    <input type="checkbox" id="screw-enabled" />
                    <span class="material-icons-outlined" aria-hidden="true">toggle_on</span>
                  </label>
                  <label class="field inline compact" for="screw-connect" style="grid-column: span 2;">
                    <span class="field-label" data-i18n="ui.connect">Connect</span>
                    <input type="checkbox" id="screw-connect" />
                  </label>
                </div>
              </div>

            </div>
          </details>
  </div>
  </section>
  </aside>
  </main>
  </div>

  <div id="generator-modal" class="modal"
    style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:1000; align-items:center; justify-content:center;">
    <div class="modal-content" style="padding:20px; border-radius:12px; max-width:500px; width:90%;">
      <h2 data-i18n="ui.generator_title">Form Generator</h2>
      <div style="margin:15px 0;">
        <label>Preset:
          <select id="gen-preset" style="width:100%; margin-top:5px; padding:4px;">
            <option value="custom">Custom</option>
            <option value="platonic" selected>Platonic / Simple Solids</option>
            <option value="complex">Complex / Star Forms</option>
            <option value="organic">Organic / Random</option>
          </select>
        </label>
      </div>
      <div style="margin:15px 0;">
        <label>Symmetry Group:
          <select id="gen-symmetry">
            <option value="cubic">Cubic (Octahedral)</option>
            <option value="tetrahedral">Tetrahedral</option>
            <option value="icosahedral">Icosahedral</option>
          </select>
        </label>
      </div>
      <div style="margin:15px 0;">
        <label>Count: <input type="number" id="gen-count" value="5" min="1" max="20"></label>
      </div>
      <div style="margin:15px 0;">
        <label>Min Faces: <input type="number" id="gen-minfaces" value="4" min="4" step="2"></label>
      </div>
      <div style="margin:15px 0;">
        <label>Ergänzungen (Max Edges): <input type="number" id="gen-maxedges" value="20" min="0" max="200"
            title="Versucht Formen zu schließen"></label>
      </div>
      <div style="display:flex; gap:10px; justify-content:flex-end;">
        <button id="gen-close" class="action-btn" style="background: #555;">Close</button>
        <button id="gen-start" class="action-btn">Generate</button>
      </div>
      <div id="gen-status" style="margin-top:10px; font-style:italic;"></div>
      <div id="gen-results"
        style="margin-top:15px; max-height:300px; overflow-y:auto; display:grid; grid-template-columns:1fr; gap:5px;">
        <!-- Results go here -->
      </div>
    </div>
  </div>

  <script type="module">
    import { App } from './js/modules/App.js';

    document.addEventListener('DOMContentLoaded', () => {
      new App();
    });
  </script>
</body>

</html>